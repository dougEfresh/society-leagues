<!DOCTYPE html "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="/layout">
<head>
</head>
<body>
<div id="score-app" layout:fragment="content">
    <div th:replace="/fragments/scores"></div>

    <div id="matches" th:if="${model ne null}" >
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="panel-title">Matches</div>
            </div>
            <div class="panel-body">
                <!--/*@thymesVar id="season" type="com.society.leagues.client.api.domain.Season"*/-->
                <!--/*@thymesVar id="date" type="java.lang.String"*/-->
                <form id="team-match-form" th:object="${model}" th:method="post" method="post"
                      th:action="@{/scores/{id}/{date} (id=${season.id},date=${date})}">
                    <div class="table-responsive">
                        <table class="table table-stripped table-bordered table-condensed table">
                            <thead>
                            <th>Results</th>
                            <th>Date</th>
                            <th>Home</th>
                            <th>Racks</th>
                            <th>Forfeits</th>
                            <th>Away</th>
                            <th>Racks</th>
                            <th>Forfeits</th>
                            </thead>
                            <tbody>

                            <!--/*@thymesVar id="matches" type="List<com.society.leagues.client.api.domain.TeamMatch>"*/-->
                            <tr th:each="match, rowStat: *{matches}">
                                <td>
                                    <a th:href="@{/scores/{id}/{date}/{matchId} (id=${season.id},date=${date},matchId=${match.id})}">
                                        Results
                                    </a>
                                </td>
                                <!--/*@thymesVar id="match" type="com.society.leagues.client.api.domain.TeamMatch"*/-->
                                <input th:field="*{matches[__${rowStat.index}__].id}" type="hidden" th:value="${match.id}" />
                                <td>
                                    <input th:field="*{matches[__${rowStat.index}__].date}"  type="text" th:value="${match.getDate()}"/>
                                </td>
                                <input th:field="*{matches[__${rowStat.index}__].time}" type="hidden" th:value="${match.getTime()}"/>
                                <td>
                                    <select th:field="*{matches[__${rowStat.index}__].home.id}" class="form-control" >
                                        <option th:each="team: ${teams}"
                                                th:text="${team.name}"
                                                th:value="${team.id}"
                                                th:selected="${team.id == match.home.id}"
                                        ></option>
                                    </select>
                                </td>

                                <td>
                                    <input th:field="*{matches[__${rowStat.index}__].homeRacks}" type="text" th:value="${match.homeRacks}"/>
                                </td>
                                <td>
                                    <input th:field="*{matches[__${rowStat.index}__].homeForfeits}" type="text" th:value="${match.homeForfeits}"/>
                                </td>
                                <td>
                                    <select th:field="*{matches[__${rowStat.index}__].away.id}" class="form-control" >
                                        <option th:each="team: ${teams}"
                                                th:text="${team.name}"
                                                th:value="${team.id}"
                                                th:selected="${team.id == match.away.id}"
                                        ></option>
                                    </select>
                                </td>
                                <td>
                                    <input  th:field="*{matches[__${rowStat.index}__].awayRacks}" type="text" th:value="${match.awayRacks}"/>
                                </td>
                                <td>
                                    <input th:field="*{matches[__${rowStat.index}__].awayForfeits}" type="text" th:value="${match.awayForfeits}"/>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </form>
                </div>
            <div class="panel-footer"><input type="submit" value="submit" /></div>
        </div>
    </div>

    <div th:if="${results ne null}" id="player-results">
        <script>
            function handleCheckbox(e) {
                var other = null;
                if (e.id.indexOf("home")>=0) {
                    other = document.getElementById(e.id.replace("home","away"));
                } else {
                    other = document.getElementById(e.id.replace("away","home"));
                }
                other.checked = !e.checked;
            }
        </script>
        <form id="result-form" th:object="${results}" th:method="post" method="post"
                         th:action="@{/scores/{id}/{date}/{matchId} (id=${season.id},date=${date},matchId=${results.matchId})}" >

    <div class="panel panel-default panel-challenge">
            <div class="panel-heading">
                <div class="panel-title">Player Results</div>
            </div>
            <div class="panel-body">
                      <div class="table-responsive">
                        <table class="table table-stripped table-bordered table-condensed table">
                            <thead>
                            <th>#</th>
                            <th>Home</th>
                            <th>Partner</th>
                            <th>Win</th>
                            <th>Away</th>
                            <th>Win</th>
                            </thead>
                            <tbody>
                            <tr th:each="result, rowStat: *{playerResults}">
                                <!--/*@thymesVar id="match" type="com.society.leagues.client.api.domain.PlayerResult"*/-->
                                <td>
                                    <input th:field="*{playerResults[__${rowStat.index}__].matchNumber}" type="text" th:value="${result.matchNumber}" />
                                </td>
                                <input th:field="*{playerResults[__${rowStat.index}__].id}" type="hidden" th:value="${result.id}" />
                                <input th:field="*{playerResults[__${rowStat.index}__].teamMatch.id}" type="hidden" th:value="${result.teamMatch.id}" />
                                <td>
                                    <select th:field="*{playerResults[__${rowStat.index}__].playerHome.id}" class="form-control" >
                                        <option th:each="user: ${homeMembers}"
                                                th:text="${user.name}"
                                                th:value="${user.id}"
                                                th:selected="${user.id == result.playerHome.id}"
                                        ></option>
                                    </select>
                                </td>
                                <td>
                                    <select th:field="*{playerResults[__${rowStat.index}__].playerHomePartner.id}" class="form-control" >
                                        <option th:each="user: ${homeMembers}"
                                                th:text="${user.name}"
                                                th:value="${user.id}"
                                                th:selected="${user.id == result.playerHomePartner.id}"
                                        ></option>
                                    </select>
                                </td>

                                <td>
                                    <input onchange="handleCheckbox(this)" th:id="#{home} +  ${result.id}" th:value="${result.homeWinner}"
                                            th:field="*{playerResults[__${rowStat.index}__].homeWinner}" type="checkbox"
                                    />

                                </td>
                                <td>
                                    <select th:field="*{playerResults[__${rowStat.index}__].playerAway.id}" class="form-control" >
                                        <option th:each="user: ${awayMembers}"
                                                th:text="${user.name}"
                                                th:value="${user.id}"
                                                th:selected="${user.id == result.playerAway.id}"
                                        ></option>
                                    </select>
                                </td> <td>
                                    <select th:field="*{playerResults[__${rowStat.index}__].playerAwayPartner.id}" class="form-control" >
                                        <option th:each="user: ${awayMembers}"
                                                th:text="${user.name}"
                                                th:value="${user.id}"
                                                th:selected="${user.id == result.playerAwayPartner.id}"
                                        ></option>
                                    </select>
                                </td>

                                <td>
                                    <input  onchange="handleCheckbox(this)"
                                            th:id="#{away} + ${result.id}" th:value="${result.awayWinner}"
                                            th:field="*{playerResults[__${rowStat.index}__].awayWinner}" type="checkbox"
                                    />
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
            </div>
        <div class="panel-footer"><input type="submit" value="submit" /></div>
    </div>
        </form>
    </div>
</div>

</body>
</html>

